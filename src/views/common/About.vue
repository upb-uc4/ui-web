<template>
    <div v-if="busy">
        <loading-spinner />
    </div>
    <div v-else class="max-w-screen-lg mx-auto w-full space-y-8">
        <h1 class="text-4xl font-extrabold text-center">About Us</h1>
        <hr class="my-4" />
        <div class="lg:flex w-full space-y-8 lg:space-y-0">
            <div class="lg:w-1/5">
                <div class="mb-4">
                    <div class="text-gray-800 text-sm font-medium">University Credits 4.0</div>
                    <div class="text-gray-500 text-sm">Paderborn, Germany</div>
                </div>
                <div class="flex space-x-4">
                    <div class="flex items-center space-x-1">
                        <a class="text-gray-400 hover:text-gray-600" target="_blank" rel="noreferrer" href="https://github.com/upb-uc4">
                            <i class="fab fa-github text-3xl" />
                        </a>
                    </div>
                    <div class="flex items-center space-x-1">
                        <a
                            class="text-gray-400 hover:text-gray-600"
                            target="_blank"
                            rel="noreferrer"
                            href="https://twitter.com/Uc4_Official"
                        >
                            <i class="fab fa-twitter text-3xl" />
                        </a>
                    </div>

                    <div class="flex items-center space-x-1">
                        <a class="text-gray-400 hover:text-gray-600" target="_blank" rel="noreferrer" href="mailto:uc4_official@web.de">
                            <i class="fas fa-envelope text-3xl" />
                        </a>
                    </div>
                </div>
            </div>
            <div class="lg:w-4/5 space-y-8">
                <div>
                    <div class="w-full mb-6 text-justify">
                        <h2 class="block text-gray-800 text-lg font-medium mb-1">Research Project Group</h2>
                        <h3 class="block text-gray-600 text-sm leading-relaxed">
                            University Credits 4.0 is an educational research project at the
                            <a
                                class="text-blue-700 hover:text-blue-800 hover:underline"
                                target="_blank"
                                rel="noreferrer"
                                href="https://cs.uni-paderborn.de/en/studies/degree-programs/computer-science/"
                            >
                                Paderborn University.
                            </a>
                            This software is a work in progress prototype of an university management system. It is based on cutting edge
                            blockchain technology to securely ensure privacy and data persistence. If you wish to learn more about us, our
                            vision or the technology we use, pay us a visit at
                            <a
                                class="text-blue-700 hover:text-blue-800 hover:underline"
                                target="_blank"
                                rel="noreferrer"
                                href="https://uc4.cs.uni-paderborn.de/"
                            >
                                uc4.cs.uni-paderborn.de.
                            </a>
                            Starting from April 2020 onwards, continuous support for this project will be provided until Q2 2021.
                        </h3>
                    </div>
                </div>
                <div>
                    <div class="w-full mb-6 text-justify">
                        <h2 class="block text-gray-800 text-lg font-medium mb-1">Demo Login</h2>
                        <h3 class="block text-gray-600 text-sm leading-relaxed">
                            We encourage you to explore our product on your own. Feel free to use any of the following login combinations.
                            However, please <span class="font-semibold">do not delete any of these accounts</span>. Each of the provided
                            accounts has a different access level which in turn unlocks certain features.
                        </h3>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                        <credential-card title="Administrator" emoji="👑" username="admin" password="admin" />
                        <credential-card title="Lecturer" emoji="👨‍🏫" username="lecturer" password="lecturer" />
                        <credential-card title="Student" emoji="👨‍🎓" username="student" password="student" />
                    </div>
                </div>
                <div>
                    <div class="w-full mb-6 text-justify">
                        <h2 class="block text-gray-800 text-lg font-medium mb-1">Server Status</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-col items-center justify-center w-full mt-20">
            <div class="flex flex-col items-center w-full mt-5">
                <versions @versions="updateVersions" />
            </div>
        </div>
    </div>
</template>

<script lang="ts">
    import Versions from "@/components/common/dev/about/Versions.vue";
    import CredentialCard from "@/components/common/dev/about/CredentialCard.vue";

    import { reactive, computed, ref, onBeforeMount } from "vue";
    import axios, { AxiosResponse } from "axios";
    import LoadingSpinner from "@/components/common/loading/Spinner.vue";

    export default {
        components: {
            CredentialCard,
            Versions,
            LoadingSpinner,
        },
        setup() {
            let busy = ref(false);
            let versions: { name: String; version: String }[] = reactive([]);
            let template: String = "";
            let bugReportURL = ref("");
            const base = "https://github.com/upb-uc4/ui-web/issues/new?";
            const labels = "&labels=bug";
            const bodyBase = "&body=";

            onBeforeMount(async () => {
                await createURL();
            });

            async function createURL() {
                busy.value = true;
                const instance = axios.create({
                    baseURL: "https://raw.githubusercontent.com/upb-uc4/.github/master/.github/ISSUE_TEMPLATE/",
                    headers: {
                        "Accept": "*/*",
                        "Content-Type": "application/json;charset=UTF-8",
                    },
                });

                await instance.get("/bug_report.md").then((response: AxiosResponse) => {
                    template = response.data;
                    template = template.substring(template.indexOf("**Describe the bug**"));
                    template = template.replace(/ /g, "%20");
                    template = template.replace(/\n/g, "%0A");
                });
                busy.value = false;
            }

            function updateVersions(emittedVersions: { name: string; version: string }[]) {
                let versionsBody = `**Versions%20(Do%20not%20change)**%0A`;
                emittedVersions.forEach((e) => {
                    versionsBody += "-%20" + e.name + ":%20" + e.version + "%0A";
                });
                versionsBody += "%0A";
                let body = bodyBase + versionsBody + template;
                bugReportURL.value = base + labels + body;
            }

            function reportProblem() {
                window.open(bugReportURL.value, "_blank", "noreferrer");
            }
            return {
                busy,
                updateVersions,
                reportProblem,
            };
        },
    };
</script>
